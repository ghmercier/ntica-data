<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>TD PLU Bioclimatique – Supports pédagogiques du module NTICA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/chapter1.html" rel="prev">
<link href="../resources/profile/logo-enpc-ip-rvb_vertical.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0b37c64f34216b628666a8dac638b53b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-0b37c64f34216b628666a8dac638b53b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-0b37c64f34216b628666a8dac638b53b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/plu-bioclimatique.html">TD PLU Bioclimatique</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../resources/profile/logo-enpc-ip-rvb_vertical.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../resources/profile/logo-enpc-ip-rvb_vertical.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accueil</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/outils-quotidiens.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Les outils du quotidien</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/qgis-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction à QGIS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Traitement de fichiers CSV</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/plu-bioclimatique.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">TD PLU Bioclimatique</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#les-planches-graphiques-au-12000e" id="toc-les-planches-graphiques-au-12000e" class="nav-link active" data-scroll-target="#les-planches-graphiques-au-12000e">Les planches graphiques au 1/2000<sup>e</sup></a>
  <ul class="collapse">
  <li><a href="#une-planche" id="toc-une-planche" class="nav-link" data-scroll-target="#une-planche">Une planche</a></li>
  <li><a href="#plein-de-planches" id="toc-plein-de-planches" class="nav-link" data-scroll-target="#plein-de-planches">Plein de planches</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ghmercier/ntica-data/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TD PLU Bioclimatique</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Dans ce TD, nous allons mettre en pratique quelques compétences acquises dans les séances précédentes et en acquérir de nouvelles sur un cas d’étude : le PLU Bioclimatique parisien.</p>
<p>Pour mémoire, la Ville de Paris a adopté en novembre 2024 son nouveau plan local d’urbanisme. La mise en révision avait été engagée en décembre 2020. Après une phase de concertation, le Conseil de Paris avait arrêté en juin 2023 un projet de PLU, qui a fait l’objet d’une enquête publique au tout début de 2024.</p>
<p>À cette époque, le dossier d’enquête publique consistait en une multitude de gros fichiers PDF : pas de géoportail, pas de couches SIG… Si l’on voulait exploiter les données, il fallait <strong>se débrouiller</strong>.</p>
<p>Nous allons voir comment !</p>
<section id="les-planches-graphiques-au-12000e" class="level2">
<h2 class="anchored" data-anchor-id="les-planches-graphiques-au-12000e">Les planches graphiques au 1/2000<sup>e</sup></h2>
<p>Dans le PLU, l’une des pièces-clés est l’atlas des planches au 1/2000<sup>e</sup>. Ces cartes regroupent les règles d’urbanisme applicables sur le territoire parisien. Elles représentent une traduction graphique du règlement écrit.</p>
<p>L’atlas est aujourd’hui accessible en ligne sur le site des <a href="https://regles-urbanisme.paris.fr/">Règles d’urbanisme de Paris</a>.</p>
<section id="une-planche" class="level3">
<h3 class="anchored" data-anchor-id="une-planche">Une planche</h3>
<p>Notre objectif va être d’afficher une des planches dans QGIS. On pourra ainsi superposer d’autres couches pour nos analyses. Pour cela, on va télécharger l’image de la carte, la traiter et la géoréférencer.</p>
<section id="téléchargement" class="level4">
<h4 class="anchored" data-anchor-id="téléchargement">Téléchargement</h4>
<p>J’ai choisi la planche D-05, qui représente une partie du 8<sup>e</sup> arrondissement.</p>
<ul>
<li>Sur le site des Règles d’urbanisme de Paris, dans l’onglet <a href="https://regles-urbanisme.paris.fr/plu-bioclimatique/jsp/site/Portal.jsp?document_id=198&amp;portlet_id=45">Documentations</a>, trouver le plan de repérage de l’atlas.</li>
<li>Cliquer sur le rectangle D-05.</li>
<li>Dans la pop-up qui surgit, cliquer sur <strong>Vue</strong> pour télécharger la planche au format PDF.</li>
</ul>
<p><a href="https://regles-urbanisme.paris.fr/plu-bioclimatique/jsp/site/Portal.jsp?document_id=198&amp;portlet_id=45#consultation_html"><img src="../resources/plu-bio/atlas_planches.jpeg" class="img-fluid"></a></p>
</section>
<section id="traitement" class="level4">
<h4 class="anchored" data-anchor-id="traitement">Traitement</h4>
<p>Nous avons un fichier PDF. Il nous faut le convertir au format image, puis éliminer le cartouche afin de ne conserver que la carte. On peut par exemple utiliser GIMP, ou Photoshop.</p>
<p>Pour aller plus vite, l’image déjà traitée est téléchargeable <a href="https://www.normalesup.org/~gmercier/D_05.jpg">ici</a>.</p>
<p><img src="../resources/plu-bio/gimp_rognage.jpeg" class="img-fluid"></p>
</section>
<section id="géoréférencement" class="level4">
<h4 class="anchored" data-anchor-id="géoréférencement">Géoréférencement</h4>
<p>Géoréférencer une image, c’est associer à chacun des pixels qui la composent une coordonnée géographique. Pour cela, il suffit de donner à QGIS les coordonnées de quelques <strong>points de contrôle</strong> (aussi appelés points d’appuis). Il se charge d’interpoler tous les autres.</p>
<section id="couche-de-référence" class="level5">
<h5 class="anchored" data-anchor-id="couche-de-référence">Couche de référence</h5>
<p>La qualité du géoréférencement dépend donc en grande partie du choix des points de contrôle. Pour être le plus précis possible, on va charger dans QGIS l’une des couches utilisée par l’Atelier parisien d’urbanisme (APUR) pour établir les cartes du PLU : la couche de l’<a href="https://opendata.apur.org/datasets/Apur::emprise-batie-paris/about">emprise bâtie de Paris</a>.</p>
<p>Ce sera l’occasion d’apprendre comment utiliser des géoservices, c’est-à-dire des flux de données sans téléchargement préalable, puisque l’APUR utilise ArcGIS Server.</p>
<ul>
<li>Créer un projet vide dans QGIS</li>
<li>Sélectionner le SCR 2154 (RGF93v1 / Lambert-93)</li>
<li><strong>Couche &gt; Ajouter une couche de serveur ArcGIS REST</strong></li>
<li>URL du serveur : <a href="https://carto2.apur.org/apur/rest/services/OPENDATA/">https://carto2.apur.org/apur/rest/services/OPENDATA/</a></li>
</ul>
<p><img src="../resources/plu-bio/arcgis_rest.jpeg" class="img-fluid"></p>
<p>Dans la liste des couches qui s’affiche, trouver <strong>EMPRISE_BATIE_PARIS</strong> et ajouter le 2<sup>e</sup> <strong>Période de construction</strong>. C’est un flux image et non un flux vectoriel, cela se chargera plus rapidement.</p>
<p><img src="../resources/plu-bio/arcgis_emprises.jpeg" class="img-fluid"></p>
</section>
<section id="géocodage" class="level5">
<h5 class="anchored" data-anchor-id="géocodage">Géocodage</h5>
<p>Ouvrir l’outil de géoréférencement :</p>
<ul>
<li><strong>Couche &gt; Géoréférencer</strong></li>
</ul>
<p>Puis, dans la nouvelle fenêtre qui s’ouvre :</p>
<ul>
<li><strong>Fichier &gt; Ouvrir un raster</strong></li>
<li>Choisir le fichier <code>D_05.jpg</code></li>
</ul>
<p>On définit ensuite les paramètres de la transformation.</p>
<p>On conservera les paramètres proposés par défaut :</p>
<ul>
<li>Type de transformation : <strong>Linéaire</strong></li>
<li>Mode de ré-échantillonnage : <strong>Plus proche voisin</strong></li>
</ul>
<p>Mais on cochera la case <strong>Créer seulement un fichier World</strong>.</p>
<p>Traduction : le fichier que l’on a est très propre, l’image n’a pas été déformée, la projection source est très certainement la même que la projection cible = on a seulement besoin de réduire/agrandir, tourner, translater l’image et non de la tordre pour l’ajuster.</p>
<p><img src="../resources/plu-bio/parametres_transformation.jpeg" class="img-fluid"></p>
<p>Puis, avec l’outil prévu à cet effet, sélectionner des points de contrôle, en cliquant successivement sur un point de l’image puis le même point sur la carte. On peut ici se contenter de <strong>trois points</strong> non alignés et distants les uns des autres. À partir de 3 points, QGIS calcule les erreurs de géoréférencement : en règle générale, il est bon d’avoir des écarts inférieurs à 10 pixels.</p>
<p><img src="../resources/plu-bio/points-de-controles.jpeg" class="img-fluid"></p>
<p>Les points de contrôles utilisés dans l’image ci-dessous sont téléchargeables <a href="../resources/plu-bio/D_05.jpg.points">ici</a>. On peut les charger si on le souhaite.</p>
<p>Appliquer ensuite la transformation. La carte s’affiche à son emplacement à Paris, on peut vérifier la qualité du géoréférencement en affichant notre couche de référence et en appliquant une légère transparence à l’image recalée.</p>
<p><img src="../resources/plu-bio/carte_georeferencee.jpeg" class="img-fluid"></p>
</section>
<section id="fichier-world" class="level5">
<h5 class="anchored" data-anchor-id="fichier-world">Fichier World</h5>
<p>Par curiosité, et parce que cela nous sera utile plus tard, allons voir dans le dossier contenant l’image <code>D_05.jpg</code>. On remarque qu’un nouveau fichier a été créé : <code>D_05.wld</code>. C’est en lisant ce fichier que QGIS est capable de transformer la coordonnée d’un pixel de l’image (ex : 234, 545) en une coordonnée géographique (ex: 647&nbsp;770, 6&nbsp;864&nbsp;143).</p>
<p>On peut ouvrir ce fichier avec un éditeur de texte.</p>
<p><img src="../resources/plu-bio/fichier_world.jpeg" class="img-fluid"></p>
<p>On retiendra :</p>
<ul>
<li>que les valeurs A et D sont des facteurs <strong>d’échelle</strong>, c’est-à-dire qu’ils donnent la taille d’un pixel dans les unités du SCR utilisé. Dans notre cas, 1 pixel sur l’image = 0,169 m dans la réalité.</li>
<li>que les valeurs B et C sont des termes de <strong>rotation</strong>. Dans notre cas, l’image n’a pas besoin d’être pivotée, elle est bien au nord, les termes sont donc nuls.</li>
<li>que les valeurs E et F sont des termes de <strong>translation</strong>, c’est-à-dire qu’ils donnent la coordonnée géographique du point supérieur gauche de la carte. On peut le vérifier sur l’image ci-dessous.</li>
</ul>
<p>Pour les <em>gory details</em>, se référer à <a href="https://pro.arcgis.com/en/pro-app/latest/help/data/imagery/world-files-for-raster-datasets.htm">cette page</a>.</p>
<p><img src="../resources/plu-bio/point_reference.jpeg" class="img-fluid"></p>
</section>
</section>
</section>
<section id="plein-de-planches" class="level3">
<h3 class="anchored" data-anchor-id="plein-de-planches">Plein de planches</h3>
<p>Nous avons traité une seule planche. Comment pourrait-on procéder si l’on voulait géoréférencer <strong>toutes</strong> les planches du PLU ? Il y a heureusement des solutions pour automatiser ce qu’on vient de faire manuellement, on va les esquisser ci-dessous.</p>
<section id="téléchargement-1" class="level4">
<h4 class="anchored" data-anchor-id="téléchargement-1">Téléchargement</h4>
<p>On voit sur le site du PLU qu’un fichier avec la <a href="https://regles-urbanisme.paris.fr/plu-bioclimatique/servlet/plugins/document/resource?id=751&amp;id_attribute=93&amp;working_content=true">liste des planches</a> est disponible.</p>
<p>C’est un fichier PDF qui contient les liens vers chacune des 134 planches. Problème : il ne sont pas apparent… On doit donc les extraire.</p>
<ul>
<li>Solution sans code : extraction avec un utilitaire en ligne comme <a href="https://supertool.org/fr/extract-urls-and-links-from-pdfs/">Supertool</a>.</li>
<li>Solution avec code : extraction avec un mini script qui utilise la libraire <a href="https://github.com/pymupdf/pymupdf"><code>PyMuPDF</code></a>.</li>
</ul>
<div id="581f67e6" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymupdf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>doc <span class="op">=</span> pymupdf.<span class="bu">open</span>(<span class="st">'Consultation_des_planches_au_1_sur_2000.pdf'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> page <span class="kw">in</span> doc:</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> link <span class="kw">in</span> page.get_links():</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>       url <span class="op">=</span> link[<span class="st">'uri'</span>]</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Do something with url</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Voici un <a href="../resources/plu-bio/liste_urls.txt">fichier texte</a> avec la liste des liens extraits. Mais on voit qu’ils sont cassés : le prestataire IT de la Ville de Paris (dont le nom figure dans les métadonnées du PDF) a oublié de substituer au nom du serveur de test celui utilisé en production !</p>
<p>On peut s’en charger grâce à la commande Find/Replace d’un éditeur de texte, ou à un coup de ligne de commande.</p>
<pre class="{sh}"><code>cat liste_urls.txt | sed -e 's/k04-siteplubioclimatique.form.apps.paris.md/regles-urbanisme.paris.fr/'
</code></pre>
<p><img src="../resources/plu-bio/liste_urls_replace_all.jpeg" class="img-fluid"></p>
<p>Ceci fait, il est possible de télécharger tous les fichiers avec une boucle en ligne de commande.</p>
<pre class="{sh}"><code>while read url; do wget --content-disposition $url; done &lt; liste_urls.txt
</code></pre>
</section>
<section id="traitement-1" class="level4">
<h4 class="anchored" data-anchor-id="traitement-1">Traitement</h4>
<p>Toutes les planches PDF sont bâties sur le même modèle, il est donc aisé d’automatiser la conversion en JPG et le rognage du cartouche.</p>
<p>Photoshop sait très bien le faire, GIMP également, mais avec un plugin. Le plus rapide serait d’utiliser <a href="https://imagemagick.org/">ImageMagick</a> en ligne de commande.</p>
<pre class="{sh}"><code># Pour les curieux, la commande pour convertir et recadrer
# le fichier PDF qu'on a utilisé plus haut
convert -density D_05.pdf D_05.jpg
convert D_05.jpg -crop 6492x4723+232+136 +repage crop/D_05.jpg
</code></pre>
</section>
<section id="géoréférencement-1" class="level4">
<h4 class="anchored" data-anchor-id="géoréférencement-1">Géoréférencement</h4>
<p>Pour géoréférencer les images obtenues, il faudrait simplement créer les fichiers World correspondant à chaque planche.</p>
<p>Pour cela, on remarque que les planches sont espacées très régulièrement : en fait, chaque planche est décalée de 750m en latitude et de 1000m en longitude. Pour générer les fichiers World, on pourrait donc partir des coordonnées de D_05 et recalculer les termes de translation (paramètres E et F) des autres planches, en laissant le facteur d’échelle et les termes de rotation inchangés.</p>
<p><img src="../resources/plu-bio/batch_fichier_world.jpeg" class="img-fluid"></p>
<p>Faisons le test sur un exemple :</p>
<ul>
<li>Télécharger le fichier <a href="https://www.normalesup.org/~gmercier/E_05.jpg"><code>E_05.jpg</code></a>.</li>
<li>Copier le fichier <code>D_05.wld</code> en un fichier <code>E_05.wld</code></li>
<li>Ouvrir le fichier <code>E_05.wld</code> et ajouter 1000 au nombre de la 5e ligne</li>
<li>Ajouter la couche <code>E_05.jpg</code> dans QGIS : <strong>Couches &gt; Ajouter une couche Raster </strong></li>
</ul>
<p>Miracle : la couche est parfaitement ajustée !</p>
<p><img src="../resources/plu-bio/ajustement_parfait.jpeg" class="img-fluid"></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/ghmercier\.github\.io\/ntica-data");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/chapter1.html" class="pagination-link" aria-label="Traitement de fichiers CSV">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Traitement de fichiers CSV</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ghmercier/ntica-data/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>